/*
 Sam Buriima
generated by Saburi Tools
 */
package com.saburi.finance.controllers;

import com.saburi.common.controllers.EditController;
import com.saburi.common.entities.LookupData;
import static com.saburi.common.utils.FXUIUtils.errorMessage;
import static com.saburi.common.utils.FXUIUtils.getEntity;
import static com.saburi.common.utils.FXUIUtils.getText;
import static com.saburi.common.utils.FXUIUtils.loadDBEntities;
import static com.saburi.common.utils.FXUIUtils.loadLookupData;
import static com.saburi.common.utils.FXUIUtils.message;
import static com.saburi.common.utils.FXUIUtils.selectItem;
import static com.saburi.common.utils.FXUIUtils.selectLookupData;
import static com.saburi.common.utils.FXUIUtils.warningOk;
import com.saburi.common.utils.Utilities.FormMode;
import java.net.URL;
import java.util.ResourceBundle;
import javafx.fxml.FXML;
import com.saburi.finance.dbaccess.ItemTemplateDA;
import javafx.scene.control.TextField;
import javafx.scene.control.ComboBox;
import javafx.scene.control.MenuItem;
import com.saburi.finance.dbaccess.ItemCategoryDA;
import com.saburi.finance.entities.ItemCategory;
import com.saburi.finance.utils.FinanceObjectNames;
import com.saburi.finance.dbaccess.MeasureGroupDA;
import com.saburi.finance.entities.MeasureGroup;
import com.saburi.finance.utils.FinanceNavigate;
import java.io.IOException;

public class ItemTemplateController extends EditController {

    private final ItemTemplateDA oItemTemplateDA = new ItemTemplateDA();
    @FXML
    private TextField txtTemplateName;
    @FXML
    private ComboBox cboItemCategory;
    @FXML
    private MenuItem cmiSelectItemCategory;
    @FXML
    private TextField txtItemCategoryGroup;
    @FXML
    private ComboBox cboItemGroup;
    @FXML
    private MenuItem cmiSelectItemGroup;
    @FXML
    private ComboBox cboVATItemGroup;
    @FXML
    private MenuItem cmiSelectVATItemGroup;
    @FXML
    private ComboBox cboInventoryGroup;
    @FXML
    private MenuItem cmiSelectInventoryGroup;
    @FXML
    private ComboBox cboMeasureGroup;
    @FXML
    private MenuItem cmiSelectMeasureGroup;
    private final ItemCategoryDA oItemCategoryDA = new ItemCategoryDA();
    private final MeasureGroupDA oMeasureGroupDA = new MeasureGroupDA();

    @Override
    public void initialize(URL url, ResourceBundle rb) {
        try {
            loadLookupData(cboItemGroup, FinanceObjectNames.ITEMGROUP);
            loadLookupData(cboVATItemGroup, FinanceObjectNames.VATITEMGROUP);
            loadLookupData(cboInventoryGroup, FinanceObjectNames.INVENTORYGROUP);
            loadDBEntities(oItemCategoryDA.getItemCategorys(), cboItemCategory);
            loadDBEntities(oMeasureGroupDA.getMeasureGroups(), cboMeasureGroup);

            this.primaryKeyControl = txtTemplateName;
            this.dbAccess = oItemTemplateDA;
            this.restrainColumnConstraint = false;
//            this.minSize = 360;
            selectItem(FinanceNavigate.MAIN_CLASS, cmiSelectItemCategory, oItemCategoryDA, "LookupData", "Item Category", 700, 400, cboItemCategory, true);
            selectLookupData(FinanceNavigate.MAIN_CLASS, cmiSelectItemGroup, FinanceObjectNames.ITEMGROUP, "LookupData", "Item Group", 700, 400, cboItemGroup, false);
            selectLookupData(FinanceNavigate.MAIN_CLASS, cmiSelectVATItemGroup, FinanceObjectNames.VATITEMGROUP, "LookupData", "VAT Item Group", 700, 400, cboVATItemGroup, false);
            selectLookupData(FinanceNavigate.MAIN_CLASS, cmiSelectInventoryGroup, FinanceObjectNames.INVENTORYGROUP, "LookupData", "Inventory Group", 700, 400, cboInventoryGroup, false);
            selectItem(FinanceNavigate.MAIN_CLASS, cmiSelectMeasureGroup, oMeasureGroupDA, "Measure Group", "Measure Group", 700, 400, cboMeasureGroup, true);
            cboItemCategory.setOnAction(e -> txtItemCategoryGroup.setText(((ItemCategory) cboItemCategory.getValue()).getItemCategoryGroup().name()));
        } catch (IOException e) {
            errorMessage(e);
        } finally {
        }
    }

    @Override
    protected void save() {
        try {
            this.editSuccessful = false;
            String templateName = getText(txtTemplateName, "Template Name");
            ItemCategory itemCategory = (ItemCategory) getEntity(cboItemCategory);
            LookupData itemGroup = (LookupData) getEntity(cboItemGroup);
            LookupData vATItemGroup = (LookupData) getEntity(cboVATItemGroup);
            LookupData inventoryGroup = (LookupData) getEntity(cboInventoryGroup);
            MeasureGroup measureGroup = (MeasureGroup) getEntity(cboMeasureGroup);

            ItemTemplateDA itemTemplateDA = new ItemTemplateDA(templateName, itemCategory, itemGroup, vATItemGroup, inventoryGroup, measureGroup);
            String buttonText = btnSave.getText();
            if (buttonText.equalsIgnoreCase(FormMode.Save.name())) {
                itemTemplateDA.save();
                message("Saved Successfully");
                clear();
            } else if (buttonText.equalsIgnoreCase(FormMode.Update.name())) {
                itemTemplateDA.update();
                message("Updated Successfully");
            }
            this.dbAccess = itemTemplateDA;
            this.editSuccessful = true;
        } catch (Exception e) {
            errorMessage(e);
        } finally {
        }
    }

    @Override
    protected void delete() {
        try {
            String templateName = getText(txtTemplateName, "Template Name");
            ItemTemplateDA itemTemplateDA = oItemTemplateDA.get(templateName);
            if (!warningOk("Confirm Delete", "You are about to delete a record with ID: " + templateName + " Are you sure you want to continue?", "Remember this action cannot be un done")) {
                return;
            }
            if (itemTemplateDA.delete()) {
                message("Deleted Successfully");
                this.clear();
            }
        } catch (Exception e) {
            errorMessage(e);
        }
    }

    @Override
    public void loadData() {
        try {
            String templateName = getText(txtTemplateName, "Template Name");

            ItemTemplateDA itemTemplateDA = oItemTemplateDA.get(templateName);
            txtTemplateName.setText(itemTemplateDA.getTemplateName());
            cboItemCategory.setValue(itemTemplateDA.getItemCategory());
            txtItemCategoryGroup.setText(itemTemplateDA.getItemCategoryGroup().toString());
            cboItemGroup.setValue(itemTemplateDA.getItemGroup());
            cboVATItemGroup.setValue(itemTemplateDA.getVATItemGroup());
            cboInventoryGroup.setValue(itemTemplateDA.getInventoryGroup());
            cboMeasureGroup.setValue(itemTemplateDA.getMeasureGroup());

        } catch (Exception e) {
            errorMessage(e);
        }

    }

}
