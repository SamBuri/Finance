/*
 Sam Buriima
generated by Saburi Tools
 */
package com.saburi.finance.controllers;

import com.saburi.common.controllers.EditController;
import com.saburi.common.entities.LookupData;
import static com.saburi.common.utils.FXUIUtils.errorMessage;
import static com.saburi.common.utils.FXUIUtils.formatValue;
import static com.saburi.common.utils.FXUIUtils.getEntity;
import static com.saburi.common.utils.FXUIUtils.getFloat;
import static com.saburi.common.utils.FXUIUtils.getText;
import static com.saburi.common.utils.FXUIUtils.loadDBEntities;
import static com.saburi.common.utils.FXUIUtils.loadLookupData;
import static com.saburi.common.utils.FXUIUtils.message;
import static com.saburi.common.utils.FXUIUtils.selectItem;
import static com.saburi.common.utils.FXUIUtils.selectLookupData;
import static com.saburi.common.utils.FXUIUtils.validateNumber;
import static com.saburi.common.utils.FXUIUtils.warningOk;
import com.saburi.common.utils.Utilities.FormMode;
import static com.saburi.common.utils.Utilities.formatNumber;
import java.net.URL;
import java.util.ResourceBundle;
import javafx.fxml.FXML;
import com.saburi.finance.dbaccess.VATPostingGroupDA;
import javafx.scene.control.TextField;
import javafx.scene.control.ComboBox;
import javafx.scene.control.MenuItem;
import com.saburi.finance.utils.FinanceObjectNames;
import com.saburi.finance.dbaccess.ChartAccountDA;
import com.saburi.finance.entities.ChartAccount;
import com.saburi.finance.utils.FinanceEnums.AccountTypes;
import com.saburi.finance.utils.FinanceNavigate;
import java.io.IOException;

public class VATPostingGroupController extends EditController {

    private final VATPostingGroupDA oVATPostingGroupDA = new VATPostingGroupDA();
    @FXML
    private TextField txtVATPostingGroupID;
    @FXML
    private ComboBox cboVATBusinessGroup;
    @FXML
    private MenuItem cmiSelectVATBusinessGroup;
    @FXML
    private ComboBox cboVATItemGroup;
    @FXML
    private MenuItem cmiSelectVATItemGroup;
    @FXML
    private TextField txtVATPercent;
    @FXML
    private ComboBox cboVATSalesAccount;
    @FXML
    private MenuItem cmiSelectVATSalesAccount;
    @FXML
    private ComboBox cboVATPurchaseAccount;
    @FXML
    private MenuItem cmiSelectVATPurchaseAccount;
    private final ChartAccountDA oChartAccountDA = new ChartAccountDA();

    @Override
    public void initialize(URL url, ResourceBundle rb) {
        try {
            loadLookupData(cboVATBusinessGroup, FinanceObjectNames.VATBUSINESSGROUP);
            loadLookupData(cboVATItemGroup, FinanceObjectNames.VATITEMGROUP);
            loadDBEntities(oChartAccountDA.getChartAccounts(AccountTypes.Liability), cboVATSalesAccount);
            loadDBEntities(oChartAccountDA.getChartAccounts(AccountTypes.Asset), cboVATPurchaseAccount);

            validateNumber(txtVATPercent);
            formatValue(txtVATPercent);
            this.primaryKeyControl = txtVATPostingGroupID;
            this.dbAccess = oVATPostingGroupDA;
            this.restrainColumnConstraint = false;
            this.prefSize = 360;
            this.setNextVATPostingGroupID();
            selectLookupData(cmiSelectVATBusinessGroup, FinanceObjectNames.VATBUSINESSGROUP, "VAT Business Group", 700, 400, cboVATBusinessGroup, false);
            selectLookupData(cmiSelectVATItemGroup, FinanceObjectNames.VATITEMGROUP, "VAT Item Group", 700, 400, cboVATItemGroup, false);
            selectItem(FinanceNavigate.MAIN_CLASS, cmiSelectVATSalesAccount, oChartAccountDA, oChartAccountDA.getChartAccountDAs(AccountTypes.Liability), "ChartAccount", "VAT Sales Account", 700, 400, cboVATSalesAccount, true);
            selectItem(FinanceNavigate.MAIN_CLASS, cmiSelectVATPurchaseAccount, oChartAccountDA, oChartAccountDA.getChartAccountDAs(AccountTypes.Asset), "ChartAccount", "VAT Purchase Account", 700, 400, cboVATPurchaseAccount, true);
        } catch (IOException e) {
            errorMessage(e);
        } finally {
        }
    }

    @Override
    protected void save() {
        try {
            this.editSuccessful =false;
            String vATPostingGroupID = getText(txtVATPostingGroupID, "VAT Posting Group ID");
            LookupData vATBusinessGroup = (LookupData) getEntity(cboVATBusinessGroup, "VAT Business Group");
            LookupData vATItemGroup = (LookupData) getEntity(cboVATItemGroup, "VAT Item Group");
            float vATPercent = getFloat(txtVATPercent, "VAT Percent");
            ChartAccount vATSalesAccount = (ChartAccount) getEntity(cboVATSalesAccount, "VAT Sales Account");
            ChartAccount vATPurchaseAccount = (ChartAccount) getEntity(cboVATPurchaseAccount, "VAT Purchase Account");

            VATPostingGroupDA vATPostingGroupDA = new VATPostingGroupDA(vATPostingGroupID, vATBusinessGroup, vATItemGroup, vATPercent, vATSalesAccount, vATPurchaseAccount);
            String buttonText = btnSave.getText();
            if (buttonText.equalsIgnoreCase(FormMode.Save.name())) {
                vATPostingGroupDA.save();
                message("Saved Successfully");
                clear();
                this.setNextVATPostingGroupID();
            } else if (buttonText.equalsIgnoreCase(FormMode.Update.name())) {
                vATPostingGroupDA.update();
                message("Updated Successfully");
            }
            this.dbAccess = vATPostingGroupDA;
            this.editSuccessful = true;
        } catch (Exception e) {
            errorMessage(e);
        } finally {
        }
    }

    @Override
    protected void delete() {
        try {
            String vATPostingGroupID = getText(txtVATPostingGroupID, "VAT Posting Group ID");
            VATPostingGroupDA vATPostingGroupDA = oVATPostingGroupDA.get(vATPostingGroupID);
            if (!warningOk("Confirm Delete", "You are about to delete a record with ID: " + vATPostingGroupID + " Are you sure you want to continue?", "Remember this action cannot be un done")) {
                return;
            }
            if (vATPostingGroupDA.delete()) {
                message("Deleted Successfully");
                this.clear();
            }
        } catch (Exception e) {
            errorMessage(e);
        }
    }

    @Override
    public void loadData() {
        try {
            String vATPostingGroupID = getText(txtVATPostingGroupID, "VAT Posting Group ID");

            VATPostingGroupDA vATPostingGroupDA = oVATPostingGroupDA.get(vATPostingGroupID);
            txtVATPostingGroupID.setText(vATPostingGroupDA.getVATPostingGroupID());
            cboVATBusinessGroup.setValue(vATPostingGroupDA.getVATBusinessGroup());
            cboVATItemGroup.setValue(vATPostingGroupDA.getVATItemGroup());
            txtVATPercent.setText(formatNumber(vATPostingGroupDA.getVATPercent()));
            cboVATSalesAccount.setValue(vATPostingGroupDA.getVATSalesAccount());
            cboVATPurchaseAccount.setValue(vATPostingGroupDA.getVATPurchaseAccount());

        } catch (Exception e) {
            errorMessage(e);
        }

    }

    private void setNextVATPostingGroupID() {
        try {
            if (btnSave.getText().equalsIgnoreCase(FormMode.Save.name())) {
                txtVATPostingGroupID.setText(oVATPostingGroupDA.getNextVATPostingGroupID(oVATPostingGroupDA.getNextIdHelper()));
            }
        } catch (Exception e) {
            errorMessage(e);
        }
    }

   

}
